{% extends 'frontend/base.html' %}

{% block content %}
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h3 class="mb-0">Detalle</h3>
      <small class="text-muted">{{ object }}</small>
    </div>
    <div class="d-flex gap-2">
      <a class="btn btn-outline-custom" href="{{ object.get_edit_url }}">Editar</a>
      <a class="btn btn-link" href="{{ request.META.HTTP_REFERER|default:request.path }}">Volver</a>
    </div>
  </div>
  <div class="card">
    <div class="card-body">
      <table class="table">
        <tbody>
          {% for field in object._meta.fields %}
            <tr>
              <th style="width:30%">{{ field.verbose_name }}</th>
              <td>{{ object|attr:field.name }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
      {% comment %} Related objects preview {# safe, uses known relations #} {% endcomment %}
      <hr>
      <h5>Relaciones</h5>
      {% if object._meta.model_name == 'furgon' %}
        <h6>Estudiantes</h6>
        <ul>
          {% for s in object.estudiantes.all %}
            <li><a href="{% url 'frontend:estudiante_detail' s.pk %}">{{ s.nombre }}</a></li>
          {% empty %}
            <li>No hay estudiantes asignados</li>
          {% endfor %}
        </ul>
        <h6>Rutas</h6>
        <ul>
          {% for r in object.rutas.all %}
            <li><a href="{% url 'frontend:ruta_detail' r.pk %}">{{ r.get_tipo_ruta_display }} ({{ r.hora_inicio }})</a></li>
          {% empty %}
            <li>No hay rutas</li>
          {% endfor %}
        </ul>
      {% elif object._meta.model_name == 'colegio' %}
        <h6>Furgones</h6>
        <ul>
          {% for f in object.furgones.all %}
            <li><a href="{% url 'frontend:furgon_detail' f.pk %}">{{ f.patente }}</a></li>
          {% empty %}
            <li>No hay furgones</li>
          {% endfor %}
        </ul>
      {% elif object._meta.model_name == 'estudiante' %}
        <h6>Pagos</h6>
        <ul>
          {% for p in object.pagos.all %}
            <li><a href="{% url 'frontend:pago_detail' p.pk %}">{{ p.monto }} - {{ p.estado }}</a></li>
          {% empty %}
            <li>No hay pagos</li>
          {% endfor %}
        </ul>
        <h6>Asistencias</h6>
        <ul>
          {% for a in object.asistencias.all %}
            <li>{{ a.fecha }} - {{ a.get_estado_display }}</li>
          {% empty %}
            <li>No hay asistencias</li>
          {% endfor %}
        </ul>
      {% elif object._meta.model_name == 'conductor' %}
        <h6>Furgones</h6>
        <ul>
          {% for f in object.furgones.all %}
            <li><a href="{% url 'frontend:furgon_detail' f.pk %}">{{ f.patente }}</a></li>
          {% empty %}
            <li>No hay furgones</li>
          {% endfor %}
        </ul>
      {% endif %}
      
    </div>
  </div>
{% endblock %}
